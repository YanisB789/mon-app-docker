version: '3.8'

# Liste de nos "cartons" (services)
services:

  # ğŸ“¦ Carton 1 : La base de donnÃ©es
  database:
    image: postgres:15-alpine    # On prend une image toute faite
    container_name: ma-db        # On donne un nom Ã  notre carton
    environment:                 # Variables d'environnement (comme des rÃ©glages)
      POSTGRES_DB: mon_app
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: motdepasse123
    volumes:                     # Pour sauvegarder les donnÃ©es
      - donnees_db:/var/lib/postgresql/data
    networks:                    # Le rÃ©seau pour communiquer
      - mon-reseau

  # ğŸ“¦ Carton 2 : Le serveur backend
  backend:
    image: yanis78/mon-backend:latest
    container_name: mon-backend
    ports:
      - "5000:5000"             # Port externe:port interne
    environment:
      DB_HOST: database         # Le backend parle Ã  "database"
      DB_USER: admin
      DB_PASSWORD: motdepasse123
    depends_on:                 # Attend que la DB soit prÃªte
      - database
    networks:
      - mon-reseau

  # ğŸ“¦ Carton 3 : Le site web frontend  
  frontend:
    image: yanis78/mon-frontend:latest
    container_name: mon-frontend
    ports:
      - "3000:3000"             # Votre site sera sur http://localhost:3000
    depends_on:                 # Attend que le backend soit prÃªt
      - backend
    networks:
      - mon-reseau

# ğŸ’¾ OÃ¹ on stocke les donnÃ©es importantes
volumes:
  donnees_db:                   # Espace de stockage pour la base de donnÃ©es

# ğŸŒ Le rÃ©seau privÃ© pour que nos cartons se parlent
networks:
  mon-reseau:
    driver: bridge
